<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             xmlns:pageModels="clr-namespace:StatsTrackerV2.PageModels"
             xmlns:models="clr-namespace:StatsTrackerV2.Models"
             xmlns:sf="clr-namespace:Syncfusion.Maui.Toolkit.Charts;assembly=Syncfusion.Maui.Toolkit"
             x:Class="StatsTrackerV2.Pages.MatchPage"
             x:Name="Match"
             x:DataType="pageModels:MatchPageModel"
             Title="Match Page">

    <ContentPage.Behaviors>
        <toolkit:EventToCommandBehavior
        x:Name="AppearingBehavior"
        BindingContext="{Binding Path=BindingContext, Source={x:Reference Match}, x:DataType=ContentPage}"
        EventName="Appearing"
        Command="{Binding AppearingCommand}" />
    </ContentPage.Behaviors>

    <Grid Padding="12"
      ColumnSpacing="12"
      RowSpacing="12"
      RowDefinitions="Auto,*,400"
      ColumnDefinitions="*,*,500">

        <VerticalStackLayout Grid.Row="0" Grid.Column="0" IsVisible="{Binding Match.IsMatchHydrated}" HorizontalOptions="Center" Spacing="10" HeightRequest="150">
            <HorizontalStackLayout Spacing="20">
                <Label Text="{Binding Match.HomeTeam.TeamName}" FontSize="Header"/>
                <Label Text="{Binding Match.HomeTeamScore}" FontSize="Header"/>
            </HorizontalStackLayout>

            <HorizontalStackLayout Spacing="10">
                <Button Text="Cards" />
                <Button Text="Subs" />
            </HorizontalStackLayout>

            <Label BackgroundColor="{Binding Match.HomeTeam.TeamColor}" />
        </VerticalStackLayout>

        <VerticalStackLayout Grid.Row="0" Grid.Column="1" IsVisible="{Binding Match.IsMatchHydrated}" HorizontalOptions="Center" Spacing="10" HeightRequest="150">
            <HorizontalStackLayout Spacing="20">
                <Label Text="{Binding Match.AwayTeam.TeamName}" FontSize="Header"/>
                <Label Text="{Binding Match.AwayTeamScore}" FontSize="Header"/>
            </HorizontalStackLayout>
            <HorizontalStackLayout Spacing="10">
                <Button Text="Cards" />
                <Button Text="Subs" />
            </HorizontalStackLayout>

            <Label BackgroundColor="{Binding Match.AwayTeam.TeamColor}"/>
        </VerticalStackLayout>

        <HorizontalStackLayout Grid.Row="0" Grid.Column="0" IsVisible="{Binding Match.IsDefaultMatch}" Spacing="10">
            <Button Text="Open Match" Command="{Binding OpenMatchCommand}"/>
            <Button Text="Create Match" Command="{Binding CreateMatchCommand}"/>
        </HorizontalStackLayout>

        <VerticalStackLayout Grid.Row="1" Grid.Column="0" Spacing="15" IsVisible="{Binding Match.IsThrowInEventCompleted}">
            <Label Text="Attacking" Background="DarkSlateGray"/>
            <HorizontalStackLayout Spacing="10">
                <Button Text="Point Shot" Command="{Binding AddPointShotEventCommand}"/>
                <Button Text="Goal Shot" Command="{Binding AddGoalShotEventCommand}"/>
                <Button Text="2 Point Shot" Command="{Binding Add2PointShotEventCommand}"/>
            </HorizontalStackLayout>

            <Label Text="Turnovers" Background="DarkSlateGray"/>
            <HorizontalStackLayout Spacing="10">
                <Button Text="Turnover Won" Command="{Binding AddTurnoverWonEventCommand}"/>
                <Button Text="Turnover Lost" Command="{Binding AddTurnoverLostEventCommand}"/>
            </HorizontalStackLayout>

            <Button Text="Kickout" Command="{Binding AddKickoutEventCommand}"/>

            <Button Text="Free/Penalty Conceded" Command="{Binding AddFreeConcededEventCommand}"/>
        </VerticalStackLayout>

        <Button Grid.Row="1" Grid.Column="0" Text="Throw In" Command="{Binding AddThrowInWonEventCommand}" CommandParameter="true" MaximumHeightRequest="50" VerticalOptions="Start" IsVisible="{Binding Match.HideThrowInButton}"/>

        <VerticalStackLayout Grid.Row="1" Grid.Column="1" Spacing="15" IsVisible="{Binding Match.IsThrowInEventCompleted}">
            <Label Text="Attacking" Background="DarkSlateGray"/>
            <HorizontalStackLayout Spacing="10">
                <Button Text="Point Shot" Command="{Binding AddPointShotEventCommand}"/>
                <Button Text="Goal Shot" Command="{Binding AddGoalShotEventCommand}"/>
                <Button Text="2 Point Shot" Command="{Binding Add2PointShotEventCommand}"/>
            </HorizontalStackLayout>

            <Label Text="Turnovers" Background="DarkSlateGray"/>
            <HorizontalStackLayout Spacing="10">
                <Button Text="Turnover Won" Command="{Binding AddTurnoverWonEventCommand}"/>
                <Button Text="Turnover Lost" Command="{Binding AddTurnoverLostEventCommand}"/>
            </HorizontalStackLayout>

            <Button Text="Kickout" Command="{Binding AddKickoutEventCommand}"/>

            <Button Text="Free/Penalty Conceded" Command="{Binding AddFreeConcededEventCommand}" IsVisible="{Binding Match.IsThrowInEventCompleted}"/>
        </VerticalStackLayout>

        <Button Grid.Row="1" Grid.Column="1" Text="Throw In Won" Command="{Binding AddThrowInWonEventCommand}" CommandParameter="false" MaximumHeightRequest="50" VerticalOptions="Start" IsVisible="{Binding Match.HideThrowInButton}"/>

        <Grid Grid.Row="0" Grid.Column="2" ColumnDefinitions="250,*" RowDefinitions="*,*" RowSpacing="12" ColumnSpacing="12">
            <Label Text="{Binding Match.HalfDisplayText}" Grid.Column="0" Grid.Row="0" FontSize="Large" HorizontalTextAlignment="Center"/>
            <Label Text="{Binding Match.DisplayTime}" Grid.Column="1" Grid.Row="0" FontSize="Large" HorizontalTextAlignment="Center"/>
            <Button Text="Start/Stop" Command="{Binding StartMatchCommand}" Grid.Column="0" Grid.Row="1"/>
            <Button Text="Pause/Play" Command="{Binding PauseMatchCommand}" Grid.Column="1" Grid.Row="1"/>
        </Grid>

        <CollectionView Grid.Row="1" Grid.Column="2" 
                        Grid.RowSpan="2" x:Name="EventList"
                        ItemsSource="{Binding Match.MatchEvents}">
            <CollectionView.ItemsLayout>
                <LinearItemsLayout Orientation="Vertical"
                                   ItemSpacing="5"/>
            </CollectionView.ItemsLayout>
            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="models:MatchEvent">
                    <HorizontalStackLayout>
                        <Label Text="{Binding DisplayText}" LineBreakMode="WordWrap" MaximumWidthRequest="500"/>
                    </HorizontalStackLayout>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

        <sf:SfCartesianChart x:Name="HomeTeamChart" IsTransposed="True" Grid.Column="0" Grid.Row="2">
            <sf:SfCartesianChart.Legend>
                <sf:ChartLegend IsVisible="True"/>
            </sf:SfCartesianChart.Legend>
            <sf:SfCartesianChart.XAxes>
                <sf:CategoryAxis/>
            </sf:SfCartesianChart.XAxes>

            <sf:SfCartesianChart.YAxes>
                <sf:NumericalAxis/>
            </sf:SfCartesianChart.YAxes>

            <sf:ColumnSeries ItemsSource="{Binding HomeTeamStats}"
                             XBindingPath="Name"
                             YBindingPath="FirstHalfValue"
                             ShowDataLabels="True"
                             Label="1st Half"/>
            
            <sf:ColumnSeries ItemsSource="{Binding HomeTeamStats}"
                             XBindingPath="Name"
                             YBindingPath="SecondHalfValue"
                             ShowDataLabels="True"
                             Label="2nd Half"/>
        </sf:SfCartesianChart>

        <sf:SfCartesianChart x:Name="AwayTeamChart" IsTransposed="True" Grid.Column="1" Grid.Row="2">
            <sf:SfCartesianChart.Legend>
                <sf:ChartLegend IsVisible="True"/>
            </sf:SfCartesianChart.Legend>
            <sf:SfCartesianChart.XAxes>
                <sf:CategoryAxis/>
            </sf:SfCartesianChart.XAxes>

            <sf:SfCartesianChart.YAxes>
                <sf:NumericalAxis/>
            </sf:SfCartesianChart.YAxes>

            <sf:ColumnSeries ItemsSource="{Binding AwayTeamStats}"
                             XBindingPath="Name"
                             YBindingPath="FirstHalfValue"
                             ShowDataLabels="True"
                             Label="1st Half"/>

            <sf:ColumnSeries ItemsSource="{Binding AwayTeamStats}"
                             XBindingPath="Name"
                             YBindingPath="SecondHalfValue"
                             ShowDataLabels="True"
                             Label="2nd Half"/>

        </sf:SfCartesianChart>

    </Grid>


</ContentPage>